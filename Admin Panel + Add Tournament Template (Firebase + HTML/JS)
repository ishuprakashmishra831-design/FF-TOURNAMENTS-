<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel - Gaming Tournament</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Admin Panel - Gaming Tournament</h1>

    <!-- Add Tournament Form -->
    <h2>Add Tournament</h2>
    <input type="text" id="tName" placeholder="Tournament Name"><br>
    <input type="text" id="tDate" placeholder="Date (YYYY-MM-DD)"><br>
    <input type="text" id="tGameMode" placeholder="Game Mode (Solo/Duo/Squad)"><br>
    <textarea id="tRules" placeholder="Rules"></textarea><br>
    <input type="number" id="tMaxParticipants" placeholder="Max Participants"><br>
    <button onclick="addTournament()">Add Tournament</button>

    <hr>

    <!-- Tournament List with Participants -->
    <h2>Tournament List</h2>
    <div id="tournamentList"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Add Tournament
        function addTournament(){
            const name = document.getElementById('tName').value;
            const date = document.getElementById('tDate').value;
            const gameMode = document.getElementById('tGameMode').value;
            const rules = document.getElementById('tRules').value;
            const maxParticipants = document.getElementById('tMaxParticipants').value;

            if(name && date && gameMode && rules && maxParticipants){
                db.collection("tournaments").add({
                    name: name,
                    date: date,
                    game_mode: gameMode,
                    rules: rules,
                    max_participants: parseInt(maxParticipants),
                    created_at: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => alert("Tournament Added Successfully!"))
                .catch(error => console.error("Error: ", error));
            } else {
                alert("Please fill all fields!");
            }
        }

        // Display Tournament List with Participants
        db.collection("tournaments").onSnapshot((snapshot) => {
            const list = document.getElementById('tournamentList');
            list.innerHTML = "";
            snapshot.forEach(async (doc) => {
                const tData = doc.data();

                // Fetch participants for this tournament
                const participantsSnapshot = await db.collection("participants")
                    .where("tournament_id", "==", doc.id)
                    .get();

                let participantNames = "";
                participantsSnapshot.forEach(pDoc => {
                    participantNames += pDoc.data().user_id + ", "; // You can replace user_id with actual name if you fetch Users collection
                });

                const div = document.createElement('div');
                div.innerHTML = `
                    <h3>${tData.name}</h3>
                    <p>Date: ${tData.date}</p>
                    <p>Mode: ${tData.game_mode}</p>
                    <p>Rules: ${tData.rules}</p>
                    <p>Max Participants: ${tData.max_participants}</p>
                    <p>Participants: ${participantNames || "None"}</p>
                    <hr>
                `;
                list.appendChild(div);
            });
        });
    </script>
</body>
</html>
